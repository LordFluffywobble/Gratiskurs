<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        canvas {
            background-color: antiquewhite;
        }
    </style>
</head>

<body onload="drawRectangles()">
    <img id="martin" src="../../img/martin3.png" style="display: none;" />
    <img id="beach" src="../../img/big-beach.jpg" style="display: none;" />
    <canvas id="game" width="800" height="600"></canvas>
    <script>
        const c = document.getElementById("game");
        const ctx = c.getContext("2d");

        const imgMartin = document.querySelector("#martin");
        const imgBeach = document.querySelector("#beach");

        let canvasWidth = c.width;
        let canvasHeight = c.height;

        let pipeWidth = 80;
        let pipeHeight = 200;
        let pipe1x = canvasWidth;
        let pipe1y = 0;
        let pipe2x = canvasWidth;
        let pipe2y = canvasHeight - pipeHeight;

        let rectWidth = 92;
        let rectHeight = 119;

        let backgroundX = 0;
        let backgroundWidth = 1000;
        let backgroundHeight = 600;

        let x = 100;
        let y = 150;
        let speedY = -1;
        let margin = 50;
        let gravity = 0.7;
        let friction = 1;
        let spacePressed = false;

        function drawRectangles() {
            clearCanvas();
            drawPipes();
            drawMartin();
            move();

            if (isOnGround() || isCollisionUpper() || isCollisionLower()) {
                if (isOnGround()) y = canvasHeight - rectHeight;
                clearCanvas();
                drawPipes();
                drawMartin();
            } else {
                addGravity();
                requestAnimationFrame(drawRectangles);
            }
        }

        function move() {
            pipe1x -= 2;
            pipe2x -= 2;
            y += speedY;
            backgroundX--;
            if (spacePressed) {
                bounce();
                spacePressed = false;
            }
        }

        function bounce() {
            speedY = -12;
        }

        function addGravity() {
            speedY += gravity;
        }

        function isOnGround() {
            return y + rectHeight >= canvasHeight;
        }

        function drawPipes() {
            ctx.fillStyle = '#FDD9A1';
            ctx.fillRect(pipe1x, pipe1y, pipeWidth, pipeHeight);
            ctx.fillRect(pipe2x, pipe2y, pipeWidth, pipeHeight);
        }

        function drawMartin() {
            ctx.drawImage(imgMartin, x, y, rectWidth, rectHeight);
        }

        function clearCanvas() {
            ctx.clearRect(0, 0, canvasWidth, canvasHeight);
            ctx.drawImage(imgBeach, backgroundX, 0, backgroundWidth, backgroundHeight);
            ctx.drawImage(imgBeach, backgroundX + backgroundWidth, 0, backgroundWidth, backgroundHeight);
            if (backgroundX <= -canvasWidth) {
                backgroundX = 0;
            }
        }

        function handleKeyDown(event) {
            if (event.code === 'Space') spacePressed = true;
        }

        document.addEventListener('keydown', handleKeyDown);

        function isCollisionUpper() {
            /*
                To firkanter kolliderer ikke hvis:

                den ene ... for den andre
                1. er helt til venstre 
                2. er helt til høyre
                3. er helt over
                4. er helt under
                Hvis ingen av disse stemmer, har vi kollisjon.
            */
            let left1 = x;
            let left2 = pipe1x;
            let right1 = x + rectWidth;
            let right2 = pipe1x + pipeWidth;
            let top1 = y;
            let top2 = pipe1y;
            let bottom1 = y + rectHeight;
            let bottom2 = pipe1y + pipeHeight;

            if (right1 < left2) return false; // 1
            if (left1 > right2) return false; // 2
            if (bottom1 < top2) return false; // 3
            if (top1 > bottom2) return false; // 4

            return true;
        }

        function isCollisionLower() {
            /*
                To firkanter kolliderer ikke hvis:

                den ene ... for den andre
                1. er helt til venstre 
                2. er helt til høyre
                3. er helt over
                4. er helt under
                Hvis ingen av disse stemmer, har vi kollisjon.
            */
            let left1 = x;
            let left2 = pipe2x;
            let right1 = x + rectWidth;
            let right2 = pipe2x + pipeWidth;
            let top1 = y;
            let top2 = pipe2y;
            let bottom1 = y + rectHeight;
            let bottom2 = pipe2y + pipeHeight;

            if (right1 < left2) return false; // 1
            if (left1 > right2) return false; // 2
            if (bottom1 < top2) return false; // 3
            if (top1 > bottom2) return false; // 4

            return true;
        }


    </script>
</body>

</html>